{% extends "base.html" %}

{% block title %}Iniciar Sesión{% endblock %}

{% block content %}

<div class="container" id="container">
  
  <button onclick="mostrarDiv1()" class="btn-cerrar-empresa"><img src="../../../static/images/close.png" alt="close"></button>
<div id="div1">
  
  <div class="form-container sign-in-container">{% with messages = get_flashed_messages(with_categories=true) %}
  
    <form id="loginForm" class="login-form"  method="POST" action="{{ url_for('auth_bp.login') }}">
            <!-- Token -->
              {{ form.csrf_token }}
               <!-- Campo oculto para el token de reCAPTCHA v3 -->
              <input type="hidden" name="g-recaptcha-response" id="g-recaptcha-response">
          
                <!-- INICIAR SESIÓN -->
                  <form action="#" class="login-form">
                    {% if messages %}
                    {% for category, message in messages %}
                    <div
                        class="p-2 mb-2 rounded-lg {{ 'bg-green-100 text-green-700' if category == 'success' else 'bg-red-100 text-red-700' }}">
                        {{ message }}
                        <button onclick="this.parentElement.remove()" class="float-right font-bold">X</button>
                    </div>
                    {% endfor %}
                    {% endif %}
                    {% endwith %}
                    <h1 class="title-log">Iniciar sesión</h1>
                      <span>Ingresa y comienza a disfrutar</span>
                        <div class="login-card">
                          <!-- Input usuario -->
                            <label for="Usuario">Usuario</label>
                              {{ form.usuario(
                                  class="inputs",
                                  id="usuario", placeholder="Usuario",
                                  value=form.usuario.data if form.usuario.data else ''
                              )}}
                          <!-- Input Password-->
                            <label for="Password">Password</label>
                              {{ form.contrasenia(
                                  class="inputs", 
                                  id="contrasenia", placeholder="*******"
                              )}}
                                {% for error in form.contrasenia.errors %}
                                <p class="text-red-500 text-sm mt-1">{{ error }}</p>
                                {% endfor %}

                            <div>
                              {{ form.remember_me(
                                class="h-4 w-4 text-[#8A5114] border-[#8A5114] rounded focus:ring-[#8A5114]",
                                id="remember_me"
                              )}}
                                <span class="remember">Recuerdame</span>
                            </div>
                        </div>
                            <div class="btn-login">
                              <button class="buttons">Iniciar sesión</button>
                            </div>
                  </form>
    </form>
   
  </div>

                          <!-- REGISTRARSE-->
                          
                              
                                <div class="container-form form-container sign-up-container">
                                  <form class="form-grid" id="registerForm">
                                    <h1>Crear cuenta</h1>
                                    <div class="form-group ">
                                      <label>Nombre(s)</label>
                                      <input class="input-registro" name="nombre" type="text" placeholder="Nombre" required/>
                                      <div  class="text-red-500 text-sm mt-1 error-text hidden"></div>
                                    </div>
                                
                                    <div class="form-group">
                                      <label>Apellido paterno</label>
                                      <input class="input-registro" type="text" name="apellido_pa" placeholder="Apellido paterno" required/>
                                      <div class="text-red-500 text-sm mt-1 error-text hidden"></div>
                                    </div>
                                
                                    <div class="form-group">
                                      <label>Apellido materno</label>
                                      <input class="input-registro" type="text" name="apellido_mat" placeholder="Apellido materno" />
                                    </div>
                                
                                    <div class="form-group">
                                      <label>Teléfono</label>
                                      <input class="input-registro" pattern="\d{10}" maxlength="10" name="telefono" type="text" placeholder="10 dígitos" required />
                                      <div class="text-red-500 text-sm mt-1 error-text hideen"></div>
                                    </div>
                                
                                    <div class="form-group-full">
                                      <label>Correo electrónico</label>
                                      <input class="input-registro" name="correo" type="email" placeholder="usuario@correo.com" required/>
                                      <div class="text-red-500 text-sm mt-1 error-text hidden"></div>
                                    </div>

                                    <div class="form-group-full">
                                      <label>Contraseña</label>
                                      <input class="input-registro" name="contraseniaR" type="password" placeholder="********" required/>
                                      <div class="text-red-500 text-sm mt-1 error-text hidden"></div>
                                    </div>
                                   
                                    <div class="button-container">
                                      <button class="buttons" type="button" onclick="registrarUsuario()">Crear cuenta</button>
                                    </div>
                                     <div class="button-container">
                                      <label>¿Eres una Empresa? Da clic <button type="button" onclick="mostrarDiv2()" class="btn-emp">aquí</button></label>
                                    </div> 
                                    </form>
                                  </div>


                          <!-- CARD DE DISEÑO -->
                          <div class="overlay-container">
                            <div class="overlay">
                                <div class="overlay-panel overlay-left">
                                  <div class="img-over">
                                    <img src="../../../static/images/fondo3.png" alt="">
                                  </div>
                                    <h1 class="title-g">Don galleto</h1>
                                      <h1 class="title-over2">¿Tienes una cuenta?</h1>
                                        <p class="msj-registro" >Inicia sesión con tus credenciales</p>
                                          <button class="buttons" id="signIn">Iniciar sesión</button>
                                </div>

                                <!-- Over login -->
                                <div class="overlay-panel overlay-right">
                                  <div class="img-log">
                                    <img src="../../../static/images/LogoGalleto.png" alt="LogoGalleto">
                                  </div>
                                      <h1 class="title-g">Don galleto</h1>
                                      <h1 class="title-over">Hola ¡Bienvenido!</h1>
                                      <p class="msj-registro">¿No tienes una cuenta? Registrate gratis</p>
                                      <button class="buttons" id="signUp">Registrarse</button>
                                </div>
                            </div>
                          </div>  
</div>
    

<!-- FORMULARIO EMPRESA-->

<div id="div2" class="form-empresa" style="display: none;">
  
  <div class="container-form-empresa">
    <form class="form-grid-empresa" id="registerEmpresa">
      <h1>Crear cuenta empresarial</h1>
      <div class="form-group-full-empresa ">
        <label>Nombre empresa</label>
        <input class="input-registro-empresa" name="nombre_empresa" type="text" placeholder="Empresa" required/>
        <div class="text-red-500 text-sm mt-1 error-text hidden"></div>
      </div>
      <div class="form-group-full-empresa">
        <label>Teléfono</label>
        <input class="input-registro-empresa" pattern="[0-9]+([\.][0-9]+)?" maxlength="10" name="telefono_empresa" type="text" placeholder="10 dígitos" required />
        <div class="text-red-500 text-sm mt-1 error-text hidden"></div>
      </div>
  
      <div class="form-group-full-empresa">
        <label>Correo electrónico</label>
        <input class="input-registro-empresa" name="correo_empresa" type="email" placeholder="usuario@correo.com" required/>
        <div class="text-red-500 text-sm mt-1 error-text hidden"></div>
      </div>

      <div class="form-group-full-empresa">
        <label>Contraseña</label>
        <input class="input-registro-empresa" name="contraseniaEmp" type="password" placeholder="********" required/>
        <div class="text-red-500 text-sm mt-1 error-text hidden"></div>
      </div>
     
      <div class="button-container-empresa">
        <button class="buttons" type="button" onclick="registrarEmpresa()">Crear cuenta</button>
      </div>
      </form>
    </div>
</div>

  <footer>
    <p>
      REDATA <i class="fa fa-heart"></i> by
      - Cada uno creé en lo posible así que, hazlo posible
    </p>
  </footer>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
        const recaptchaElement = document.getElementById('g-recaptcha-response');
        
        if (recaptchaElement) {
            grecaptcha.ready(() => {
                grecaptcha.execute('{{ recaptcha_site_key_v3 }}', { action: 'login' })
                .then(token => {
                    recaptchaElement.value = token;
                });
            });
    
            setInterval(() => {
                grecaptcha.execute('{{ recaptcha_site_key_v3 }}', { action: 'login' })
                .then(token => {
                    recaptchaElement.value = token;
                });
            }, 115000);
        }
    });
    </script>
{% endblock %}